import board
import busio
from PIL import Image, ImageDraw, ImageFont
import adafruit_ssd1306
import time
# --- CONFIGURACIÓN DE LA PANTALLA ---
# Asegúrate de que las dimensiones (WIDTH y HEIGHT) coincidan con tu pantalla
WIDTH = 128
HEIGHT = 64
I2C_ADDRESS = 0x3c # La dirección I2C puede ser 0x3d en algunos modelos

# Inicializa la comunicación I2C
i2c = busio.I2C(board.SCL, board.SDA)

# Crea el objeto de la pantalla OLED
# Si tienes un error de "OSError: [Errno 121] Remote I/O error", prueba a cambiar el I2C_ADDRESS
try:
    oled = adafruit_ssd1306.SSD1306_I2C(WIDTH, HEIGHT, i2c, addr=I2C_ADDRESS)
except (ValueError, OSError) as e:
    print(f"Error al inicializar la pantalla OLED: {e}")
    print("Verifica la conexión del hardware y la dirección I2C con 'sudo i2cdetect -y 1'")
    exit()

# --- AQUÍ VA TU IMAGEN DE ARDUINO ---
# 1. Copia los valores hexadecimales de tu array de Arduino.
# 2. Pégalos dentro del bytearray().
#
# Este es un ejemplo de un pequeño logo de Raspberry Pi de 32x32 píxeles
# El formato debe ser un 'bytearray' para que la librería Pillow pueda leerlo.

# Asegúrate de que el tamaño del array coincida con (WIDTH * HEIGHT) / 8
# Para una imagen de 128x64, el array debe tener 1024 bytes.
# Si tu imagen es más pequeña, el resto del espacio quedará en negro.
imagen_arduino_bytes = bytearray([

0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0x06, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0x06, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x38, 0x00, 0x00, 0xe0, 0x0e, 0x00, 0x00, 0x38, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x01, 0xf0, 0x00, 0x00, 0xf0, 0x0e, 0x00, 0x00, 0x1f, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x0f, 0xe0, 0x00, 0x00, 0xf0, 0x1e, 0x00, 0x00, 0x0f, 0xe0, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x3f, 0xe0, 0x00, 0x00, 0xff, 0xff, 0x00, 0x00, 0x0f, 0xfc, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x01, 0xff, 0xe0, 0x00, 0x00, 0xff, 0xfe, 0x00, 0x00, 0x07, 0xff, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x07, 0xff, 0xe0, 0x00, 0x01, 0xff, 0xff, 0x00, 0x00, 0x07, 0xff, 0xc0, 0x00, 0x00,
        0x00, 0x00, 0x1f, 0xff, 0xc0, 0x00, 0x01, 0xff, 0xff, 0x00, 0x00, 0x0f, 0xff, 0xf0, 0x00, 0x00,
        0x00, 0x00, 0x7f, 0xff, 0xe0, 0x00, 0x01, 0xff, 0xff, 0x00, 0x00, 0x07, 0xff, 0xfc, 0x00, 0x00,
        0x00, 0x01, 0xff, 0xff, 0xe0, 0x00, 0x01, 0xff, 0xff, 0x00, 0x00, 0x0f, 0xff, 0xff, 0x00, 0x00,
        0x00, 0x03, 0xff, 0xff, 0xf0, 0x00, 0x01, 0xff, 0xff, 0x00, 0x00, 0x0f, 0xff, 0xff, 0x80, 0x00,
        0x00, 0x0f, 0xff, 0xff, 0xf0, 0x00, 0x01, 0xff, 0xff, 0x80, 0x00, 0x1f, 0xff, 0xff, 0xe0, 0x00,
        0x00, 0x0f, 0xff, 0xff, 0xf8, 0x00, 0x03, 0xff, 0xff, 0x80, 0x00, 0x1f, 0xff, 0xff, 0xf0, 0x00,
        0x00, 0x3f, 0xff, 0xff, 0xf8, 0x00, 0x03, 0xff, 0xff, 0x80, 0x00, 0x3f, 0xff, 0xff, 0xf8, 0x00,
        0x00, 0x7f, 0xff, 0xff, 0xfe, 0x00, 0x03, 0xff, 0xff, 0xc0, 0x00, 0xff, 0xff, 0xff, 0xfc, 0x00,
        0x00, 0xff, 0xff, 0xff, 0xff, 0x00, 0x0f, 0xff, 0xff, 0xc0, 0x01, 0xff, 0xff, 0xff, 0xfe, 0x00,
        0x01, 0xff, 0xff, 0xff, 0xff, 0xf4, 0x7f, 0xff, 0xff, 0xfe, 0x8f, 0xff, 0xff, 0xff, 0xff, 0x00,
        0x01, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x80,
        0x03, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x80,
        0x07, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xc0,
        0x07, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xc0,
        0x07, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xc0,
        0x07, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0,
        0x0f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0,
        0x0f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0,
        0x07, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0,
        0x0f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0,
        0x07, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xc0,
        0x07, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xc0,
        0x07, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xc0,
        0x03, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xc0,
        0x03, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x80,
        0x03, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x80,
        0x01, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x00,
        0x00, 0xff, 0xff, 0xfa, 0x7f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xfe, 0xbf, 0xff, 0xff, 0x00,
        0x00, 0xff, 0xff, 0xe0, 0x0f, 0xfe, 0x0f, 0xff, 0xff, 0xe0, 0xff, 0xe0, 0x0f, 0xff, 0xfe, 0x00,
        0x00, 0x7f, 0xff, 0xc0, 0x03, 0xf8, 0x03, 0xff, 0xff, 0xc0, 0x3f, 0x80, 0x03, 0xff, 0xfc, 0x00,
	0x00, 0x3f, 0xff, 0x80, 0x00, 0xf0, 0x01, 0xff, 0xff, 0x00, 0x1f, 0x00, 0x03, 0xff, 0xf8, 0x00,
        0x00, 0x1f, 0xff, 0x00, 0x00, 0x60, 0x00, 0xff, 0xfe, 0x00, 0x0c, 0x00, 0x01, 0xff, 0xf0, 0x00,
        0x00, 0x07, 0xff, 0x00, 0x00, 0x20, 0x00, 0x7f, 0xfc, 0x00, 0x00, 0x00, 0x01, 0xff, 0xe0, 0x00,
        0x00, 0x03, 0xff, 0x80, 0x00, 0x00, 0x00, 0x3f, 0xf8, 0x00, 0x00, 0x00, 0x01, 0xff, 0x80, 0x00,
        0x00, 0x01, 0xff, 0x80, 0x00, 0x00, 0x00, 0x1f, 0xf0, 0x00, 0x00, 0x00, 0x03, 0xff, 0x00, 0x00,
        0x00, 0x00, 0x7f, 0x80, 0x00, 0x00, 0x00, 0x0f, 0xf0, 0x00, 0x00, 0x00, 0x03, 0xfc, 0x00, 0x00,
        0x00, 0x00, 0x1f, 0xc0, 0x00, 0x00, 0x00, 0x0f, 0xe0, 0x00, 0x00, 0x00, 0x03, 0xf0, 0x00, 0x00,
        0x00, 0x00, 0x07, 0xc0, 0x00, 0x00, 0x00, 0x07, 0xc0, 0x00, 0x00, 0x00, 0x07, 0xc0, 0x00, 0x00,
        0x00, 0x00, 0x01, 0xe0, 0x00, 0x00, 0x00, 0x03, 0x80, 0x00, 0x00, 0x00, 0x0f, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x30, 0x00, 0x00, 0x00, 0x03, 0x80, 0x00, 0x00, 0x00, 0x08, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00

])


# --- CÓDIGO PARA MOSTRAR LA IMAGEN ---

# Limpia la pantalla por si había algo antes
oled.fill(0)
oled.show()

# Crea una imagen en blanco en modo monocromático ('1') con el tamaño de la pantalla
# Esta imagen servirá como nuestro "lienzo" o "buffer"
lienzo = Image.new('1', (oled.width, oled.height))

# Crea un objeto para dibujar en el lienzo (no lo usaremos, pero es parte del proceso)
# draw = ImageDraw.Draw(lienzo)

# Carga los bytes de tu imagen de Arduino directamente en el lienzo de Pillow
# '1' indica el modo (1-bit píxeles), 'raw' es el formato de los datos
# Esta es la parte clave: convierte tu array en una imagen visible
imagen_final = Image.frombytes('1', (WIDTH, HEIGHT), bytes(imagen_arduino_bytes))

# Dibuja la imagen cargada en el buffer de la pantalla
oled.image(imagen_final)

# Envía el buffer a la pantalla para que se muestre físicamente
oled.show()

print("Imagen mostrada en la pantalla OLED. Presiona Ctrl+C para salir.")

# Mantiene el script corriendo para que la imagen permanezca visible
try:
    while True:
        pass
except KeyboardInterrupt:
    # Limpia la pantalla al salir
    oled.fill(0)
    oled.show()
    print("\nPrograma terminado. Pantalla limpiada.")
print("Servicio OLED activo. Manteniendo imagen de Batman...")
while True:
    try:
        time.sleep(3600)  # Esperar 1 hora
    except Exception as e:
        error_msg = f"{time.ctime()}: ERROR - {str(e)}\n"
        print(error_msg)
        with open('/home/sinother/oled_error.log', 'a') as f:
            f.write(error_msg)



